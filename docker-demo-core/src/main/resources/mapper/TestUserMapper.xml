<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.dockerdemo.mapper.TestUserMapper">

    <resultMap id="TestUserMap" type="org.example.dockerdemo.entity.TestUser">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
        <result column="age" property="age"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="delete_flag" property="deleteFlag"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, username, password, email, age, status, create_time, update_time, delete_flag
    </sql>

    <select id="findByUsernameAndAge" resultMap="TestUserMap">
        SELECT <include refid="Base_Column_List"/>
        FROM tb_test_user
        WHERE username = #{username}
          AND age = #{age}
          AND delete_flag = 0
        LIMIT 1
    </select>

    <select id="findPage" resultMap="TestUserMap">
        SELECT <include refid="Base_Column_List"/>
        FROM tb_test_user
        WHERE delete_flag = 0
        ORDER BY id
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <insert id="insert">
        INSERT INTO tb_test_user
        (id, username, password, email, age, status, create_time, update_time, delete_flag)
        VALUES
        (#{id}, #{username}, #{password}, #{email}, #{age}, #{status},
         #{createTime}, #{updateTime}, #{deleteFlag})
    </insert>

    <update id="update">
        UPDATE tb_test_user
        <set>
            <if test="username != null and username != ''">username = #{username},</if>
            <if test="password != null and password != ''">password = #{password},</if>
            <if test="email != null and email != ''">email = #{email},</if>
            <if test="age != null">age = #{age},</if>
            <if test="status != null">status = #{status},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="deleteFlag != null">delete_flag = #{deleteFlag},</if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="logicalDelete">
        UPDATE tb_test_user SET delete_flag = 1 WHERE id = #{id}
    </update>

</mapper>
